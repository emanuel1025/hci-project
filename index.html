<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>HCI Project</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/SpeechKITT/0.3.0/speechkitt.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="talkify.js"></script>
    <script>
  if (annyang) {
    // Let's define a command.
    const commands = {
      'hello': () => { alert('Hello world!'); }
    };

    // Add our commands to annyang
    // annyang.addCommands(commands);

    SpeechKITT.annyang();
    SpeechKITT.setStylesheet('https://cdnjs.cloudflare.com/ajax/libs/SpeechKITT/0.3.0/themes/flat.css');
    SpeechKITT.render();

    // Start listening.
    // annyang.start();
  }
  </script>
</head>
<body>
  <div>
    <div class="first-row">
      <header id="siteHeader" class="site-header">

        <nav class="navbar  navbar-default">
          <div class="container" style="padding: 0 10px !important">
            <div class="searchbox hideTablet ">
              <form class="navbar-form  " role="search">
                <div class="input-group">
                  
                  <input type="text" class="input-control paddingR40 searchBar"placeholder="Search" name="url">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
    </div>
    <!-- <iframe src="https://en.wikipedia.org/wiki/Wii" class="second-row"></iframe> -->
  </div>
  <div id="page-content">
  </div>
  <script>
    function zoomPage(zoom_in) {
      var zoom_level = $('#page-content').css( "zoom" );
      var zoom_level_int = Number(zoom_level.slice(-1))
      if (zoom_in) {
        $("#page-content").css({"zoom": (zoom_level_int + 0.1).toString()});
      }
      else {
        $("#page-content").css({"zoom": (zoom_level_int - 0.1).toString()});
      }
    }

    talkify.config.remoteService.host = 'https://talkify.net';
    talkify.config.remoteService.apiKey = '3fe125da-146b-4170-964b-ce631783c6ad';

    talkify.config.ui.audioControls.enabled = true; //<-- Disable to get the browser built in audio controls
    talkify.config.ui.audioControls.voicepicker.enabled = true;
    talkify.config.ui.audioControls.container = document.getElementById("player-and-voices");
    talkify.autoScroll.activate();

    $("#page-content").ready(function() {
      setTimeout(function() {
        var player = new talkify.TtsPlayer()
          .enableTextHighlighting()
          .forceVoice({name: "Zira"});

        var playlist = new talkify.playlist()
          .begin()
          .usingPlayer(player)
          .withRootSelector('#page-content')
          .withTextInteraction()
          .build();
    
        playlist.play();
        console.log("I have loaded!")
      }, 3000);
      zoomPage(true);
    })

    let headers = new Headers();

    headers.append('Content-Type', 'application/json');
    headers.append('Accept', 'application/json');
    headers.append('Origin','http://localhost:3000');
    headers.append('Access-Control-Allow-Origin', 'http://localhost:3000');
    headers.append('Access-Control-Allow-Credentials', 'true');

    let searchParams = new URLSearchParams(window.location.search)
    let url = searchParams.get('url')
    fetch('http://localhost:3000/website/' + encodeURIComponent(url), {
        mode: 'cors',
        headers: headers
    }).then(function (response) {
      // The API call was successful!
      // console.log(response);
      return response.text();
    }).then(function (data) {
      // This is the JSON from our response
      // console.log(data);
      $('#page-content').html(data);
    }).catch(function (err) {
      // There was an error
      console.warn('Something went wrong.', err);
    });

  </script>
</body>
</html>
